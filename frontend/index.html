<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description"
    content="Play Buraco card game online with friends. Create a room and invite others with a code!">
  <title>Buraco - Multiplayer Card Game</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Lato:wght@400;700&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="/src/styles/main.css">
  <link rel="stylesheet" href="/src/styles/cards.css">
  <link rel="stylesheet" href="/src/styles/table.css">
  <!-- Config - UPDATE BACKEND_URL for production -->
  <script src="/config.js"></script>
</head>

<body>
  <div id="app">
    <!-- Character Selection Screen -->
    <div id="character-selection-screen" class="screen active">
      <div class="selection-container">
        <div class="selection-header">
          <h1>Choose Your Character</h1>
        </div>

        <div class="avatars-grid">
          <div class="avatar-option" data-avatar="1">
            <img src="/assets/avatars/avatar_1.png" alt="Avatar 1">
          </div>
          <div class="avatar-option" data-avatar="2">
            <img src="/assets/avatars/avatar_2.png" alt="Avatar 2">
          </div>
          <div class="avatar-option" data-avatar="3">
            <img src="/assets/avatars/avatar_3.png" alt="Avatar 3">
          </div>
          <div class="avatar-option" data-avatar="4">
            <img src="/assets/avatars/avatar_4.png" alt="Avatar 4">
          </div>
        </div>

        <div class="name-input-container">
          <input type="text" id="selection-nickname-input" placeholder="Enter Your Name" maxlength="15"
            autocomplete="off">
        </div>

        <button id="confirm-character-btn" class="primary-btn" disabled>Continue</button>
      </div>
    </div>

    <!-- Lobby Screen -->
    <div id="lobby-screen" class="screen">
      <div class="lobby-container">
        <header class="lobby-header">
          <h1 class="game-title">Buraco</h1>
          <p class="subtitle">Classic Card Game</p>
        </header>

        <div class="lobby-content">
          <!-- Nickname section removed, moved to character selection -->

          <div class="action-buttons">
            <div class="create-room-section">
              <h3>Create New Room</h3>
              <div class="player-count-selector">
                <button class="player-count-btn" data-count="2">2 Players</button>
                <button class="player-count-btn selected" data-count="4">4 Players</button>
                <button class="player-count-btn" data-count="6">6 Players</button>
              </div>

              <!-- Room Configuration Options -->
              <div class="room-config">
                <div class="config-row">
                  <label>Turn Timer (sec)</label>
                  <div class="config-selector">
                    <button class="config-btn" data-timer="0">Off</button>
                    <button class="config-btn" data-timer="30">30</button>
                    <button class="config-btn selected" data-timer="60">60</button>
                    <button class="config-btn" data-timer="90">90</button>
                  </div>
                </div>
                <div class="config-row">
                  <label>Decks</label>
                  <div class="config-selector">
                    <button class="config-btn" data-decks="2">2</button>
                    <button class="config-btn selected" data-decks="3">3</button>
                    <button class="config-btn" data-decks="4">4</button>
                  </div>
                </div>
                <div class="config-row">
                  <label>Jokers per Deck</label>
                  <div class="config-selector">
                    <button class="config-btn" data-jokers="0">0</button>
                    <button class="config-btn selected" data-jokers="2">2</button>
                    <button class="config-btn" data-jokers="4">4</button>
                  </div>
                </div>
              </div>

              <button id="create-room-btn" class="primary-btn">Create Room</button>
            </div>

            <div class="divider">
              <span>OR</span>
            </div>

            <div class="join-room-section">
              <h3>Join Room</h3>
              <input type="text" id="room-code-input" placeholder="Enter room code" maxlength="6" autocomplete="off">
              <button id="join-room-btn" class="secondary-btn">Join Room</button>
            </div>
          </div>
        </div>

        <div id="error-message" class="error-message hidden"></div>
      </div>
    </div>

    <!-- Waiting Room Screen -->
    <div id="waiting-screen" class="screen">
      <div class="waiting-container">
        <h2>Waiting Room</h2>
        <div class="room-code-display">
          <span>Room Code:</span>
          <strong id="display-room-code">------</strong>
          <button id="copy-code-btn" class="icon-btn" title="Copy code">ðŸ“‹</button>
        </div>

        <!-- Room Configuration Display -->
        <div class="room-config-display" id="room-config-display">
          <div class="config-item"><span>Timer:</span> <strong id="config-timer">60s</strong></div>
          <div class="config-item"><span>Decks:</span> <strong id="config-decks"></strong></div>
          <div class="config-item"><span>Jokers/Deck:</span> <strong id="config-jokers"></strong></div>
        </div>

        <div class="players-list">
          <h3>Players (<span id="player-count">0</span>/<span id="max-players">4</span>)</h3>
          <div id="players-container"></div>
        </div>

        <div class="waiting-actions">
          <button id="start-game-btn" class="primary-btn" disabled>Start Game</button>
          <button id="leave-room-btn" class="secondary-btn">Leave Room</button>
        </div>
      </div>
    </div>

    <!-- Game Screen -->
    <div id="game-screen" class="screen">
      <div class="game-container">
        <!-- Top status bar -->
        <div class="game-status-bar">
          <div class="turn-indicator">
            <span id="current-turn">Waiting...</span>
          </div>
          <div id="opponents-row" class="opponents-row"></div>

          <!-- Opponent badge (top center for 2-player) -->
          <div id="opponent-badge" class="opponent-badge-container"></div>
        </div>

        <!-- Game table -->
        <div class="game-table">
          <!-- Opponents row (top) for 4/6 player games -->


          <!-- Legacy player positions (hidden) -->
          <div id="player-top" class="table-player top-player hidden"></div>
          <div id="player-left" class="table-player left-player hidden"></div>
          <div id="player-right" class="table-player right-player hidden"></div>

          <!-- Legacy opponents area (hidden) -->
          <div id="opponents-area" class="hidden"></div>

          <!-- Center table area -->
          <!-- Melds area - Split View -->
          <div class="melds-container">
            <div id="team-a-melds" class="team-melds team-a-zone">
              <div class="zone-header">
                <h4>Team A</h4>
                <span class="zone-points" id="team-a-zone-points">0 Pts.</span>
              </div>
              <div class="melds-grid"></div>
            </div>

            <div id="team-b-melds" class="team-melds team-b-zone">
              <div class="zone-header">
                <h4>Team B</h4>
                <span class="zone-points" id="team-b-zone-points">0 Pts.</span>
              </div>
              <div class="melds-grid"></div>
            </div>
          </div>

          <!-- Center Strip: Piles -->
          <div class="piles-area">
            <div id="draw-pile" class="pile draw-pile">
              <div class="card-stack"></div>
              <span id="draw-count">41</span>
            </div>
            <div id="discard-pile" class="pile discard-pile">
              <div class="card-placeholder">Empty</div>
            </div>
          </div>

          <!-- Pozzetti indicator (Bottom Left) -->
          <div class="pozzetti-area">
            <div id="pozzetto-1" class="pozzetto">
              <div class="card-stack"></div>
              <span>Bukharo 1</span>
              <span class="pozzetto-count" id="pozzetto-1-count">11 cards</span>
            </div>
            <div id="pozzetto-2" class="pozzetto">
              <div class="card-stack"></div>
              <span>Bukharo 2</span>
              <span class="pozzetto-count" id="pozzetto-2-count">11 cards</span>
            </div>
          </div>
        </div>

        <!-- Player's hand -->
        <div class="player-hand-area">
          <div class="hand-controls">
            <button id="meld-btn" class="control-btn" disabled>Play Meld</button>
            <button id="sort-hand-btn" class="control-btn">Sort Hand</button>
          </div>
          <div id="player-hand" class="player-hand"></div>
          <!-- My player badge (bottom right) -->
          <div id="my-player-badge" class="my-badge-container"></div>
        </div>

        <!-- Hidden action buttons (actions triggered via drag/click) -->
        <div class="action-bar hidden">
          <button id="draw-btn" class="action-btn" disabled>Draw Card</button>
          <button id="take-discard-btn" class="action-btn" disabled>Take Discard</button>
          <button id="discard-btn" class="action-btn" disabled>Discard</button>
        </div>
      </div>
    </div>

    <!-- Game Over Modal -->
    <div id="game-over-modal" class="modal hidden">
      <div class="modal-content game-over-content">
        <h2 id="winner-text">Game Over!</h2>

        <div class="score-cards-container">
          <!-- Team A Card -->
          <div class="score-card team-a-card">
            <div class="score-card-header">
              <h3>Team A</h3>
              <div class="total-score" id="total-score-a">0</div>
            </div>
            <div class="score-breakdown" id="breakdown-a">
              <div class="breakdown-row">
                <span>Meld Points</span>
                <span class="breakdown-value" id="meld-score-a">0</span>
              </div>
              <div class="breakdown-row">
                <span>Same Rank Burracos</span>
                <span class="breakdown-value" id="same-rank-a">0 Ã— 100</span>
              </div>
              <div class="breakdown-row">
                <span>Clean Burracos</span>
                <span class="breakdown-value" id="clean-burraco-a">0 Ã— 200</span>
              </div>
              <div class="breakdown-row">
                <span>Dirty Burracos</span>
                <span class="breakdown-value" id="dirty-burraco-a">0 Ã— 200</span>
              </div>
              <div class="breakdown-row">
                <span>Going Out Bonus</span>
                <span class="breakdown-value" id="going-out-a">0</span>
              </div>
              <div class="breakdown-row">
                <span>Pozzetto Bonus</span>
                <span class="breakdown-value" id="pozzetto-a">0</span>
              </div>
              <div class="breakdown-row penalty">
                <span>Hand Penalty</span>
                <span class="breakdown-value" id="penalty-a">0</span>
              </div>
            </div>
          </div>

          <!-- Team B Card -->
          <div class="score-card team-b-card">
            <div class="score-card-header">
              <h3>Team B</h3>
              <div class="total-score" id="total-score-b">0</div>
            </div>
            <div class="score-breakdown" id="breakdown-b">
              <div class="breakdown-row">
                <span>Meld Points</span>
                <span class="breakdown-value" id="meld-score-b">0</span>
              </div>
              <div class="breakdown-row">
                <span>Same Rank Burracos</span>
                <span class="breakdown-value" id="same-rank-b">0 Ã— 100</span>
              </div>
              <div class="breakdown-row">
                <span>Clean Burracos</span>
                <span class="breakdown-value" id="clean-burraco-b">0 Ã— 200</span>
              </div>
              <div class="breakdown-row">
                <span>Dirty Burracos</span>
                <span class="breakdown-value" id="dirty-burraco-b">0 Ã— 200</span>
              </div>
              <div class="breakdown-row">
                <span>Going Out Bonus</span>
                <span class="breakdown-value" id="going-out-b">0</span>
              </div>
              <div class="breakdown-row">
                <span>Pozzetto Bonus</span>
                <span class="breakdown-value" id="pozzetto-b">0</span>
              </div>
              <div class="breakdown-row penalty">
                <span>Hand Penalty</span>
                <span class="breakdown-value" id="penalty-b">0</span>
              </div>
            </div>
          </div>
        </div>

        <button id="back-to-lobby-btn" class="primary-btn">Back to Lobby</button>
      </div>
    </div>
  </div>

  <script type="module" src="/src/main.js"></script>
</body>

</html>